### ip协议
 * 不可靠
   + 它不能保证IP数据报能成功地到达目的地。IP仅提供最好的传输服务。如果发生某种错误时，如某个路由器暂时用完了缓冲区，
   IP有一个简单的错误处理算法：丢弃该数据报，然后发送ICMP消息报给信源端。任何要求的可靠性必须由上层来提供（如TCP）
 * 无连接
   + IP并不维护任何关于后续数据报的状态信息。每个数据报的处理是相互独立的。这也说明，IP数据报可以不按发送顺序接收。
   如果一信源向相同的信宿发送两个连续的数据报（先是A，然后是B），每个数据报都是独立地进行路由选择，可能选择不同的路线，
   因此B可能在A到达之前先到达。
   
   
 * big endian字节序
   + 4个字节的32 bit值以下面的次序传输：首先是0～7bit，其次8～15 bit，然后16～23 bit，最后是24~31 bit。
   + 由于TCP/IP首部中所有的二进制整数在网络中传输时都要求以这种次序，因此它又称作网络字节序。
   + 以其他形式存储二进制整数的机器，如little endian格式，则必须在传输数据之前把首部转换成网络字节序。
   
 * ip头默认是20个字节
   
 * 首部长度
   + 占4位，即2^4-1 = 15
   + 15表示的是15个32位，即最大15*4=60个字节 
   + 首部长度指的是首部占32 bit字的数目，包括任何选项。由于它是一个4比特字段，因此首部最长为60个字节。
   + 普通IP数据报（没有任何选择项）字段的值是5
   
 * 现在大多数的TCP/IP实现都不支持TOS特性
 
 * 总长度字段
   + 占16位，2个字节，所以ip数据报最长为2^16 -1 = 65565个字节。
   + 指整个IP数据报的长度，以字节为单位
   + 利用首部长度字段和总长度字段，就可以知道IP数据报中数据内容的起始位置和长度
     - 总长度- 首部长 = 数据长
     - 跟据首部长度之后就是数据内容起始位置
   + 当数据被分片时，该字段的值也随着变化
   
   + 总长度字段是IP首部中必要的内容
     - 因为一些数据链路（如以太网）需要填充一些数据以达到最小长度。
     尽管以太网的最小帧长为46字节（见图2-1），但是IP数据可能会更短。
     如果没有总长度字段，那么IP层就不知道46字节中有多少是IP数据报的内容。
     
 * 标识字段
   + 唯一地标识主机发送的每一份数据报，通常每发送一份报文它的值就会加1
   
 * TTL
   + 生存时间字段设置了数据报可以经过的最多路由器数
   + TTL的初始值由源主机设置（通常为32或64），一旦经过一个处理它的路由器，它的值就减去1
   + 当该字段的值为0时，数据报就被丢弃，并发送ICMP报文通知源主机
   
 * 首部检验和字段
   + 是根据IP首部计算的检验和码。它不对首部后面的数据进行计算
   + 如果接收端检验和失败，那么IP就丢弃收到的数据报，但是不生成差错报文，由上层去发现丢失的数据报并进行重传。
   
 * 可选字段
   + 选项字段一直都是以32 bit作为界限，在必要的时候插入值为0的填充字节
   + 这样就保证IP首部始终是32 bit的整数倍（这是首部长度字段所要求的）。
   
### ip分片
 * 在ip层分片
 * 分片可以发生在原始发送端主机上，也可以发生在中间路由器上。
 * 把一份IP数据报分片以后，只有到达目的地才进行重新组装
 * 重新组装由目的端的IP层来完成，其目的是使分片和重新组装过程对运输层（TCP和UDP）是透明的，除了某些可能的越级操作外
 * 已经分片过的数据报有可能会再次进行分片（可能不止一次）。IP首部中包含的数据为分片和重新组装提供了足够的信息。
 * 标识字段 16位
    + 该值在数据报分片时被复制到每个片中
    
 * 标志字段 3位
    + 用其中一个比特来表示“更多的片”
    + 除了最后一片外，其他每个组成数据报的片都要把该比特置1
    
    + 标志字段中有一个比特称作“不分片”位，如果将这一比特置1，IP将不对数据报进行分片
    
 * 偏移字段
   + 是该片偏移原始数据报开始处的位置
   
 * 另外，当数据报被分片后，每个片的总长度值要改为该片的长度值。
 
 * 尽管IP分片过程看起来是透明的
   + 但有一点让人不想使用它：即使只丢失一片数据也要重传整个数据报。
   + 因为IP层本身没有超时重传的机制
   > 就这个原因，经常要避免分片
   
 * 在分片时，除最后一片外，其他每一片中的数据部分（除IP首部外的其余部分）必须是8字节的整数倍。在本例中，1480是8的整数倍。
 * 需要重申的是，任何传输层首部只出现在第1片数据中。
 * IP数据报是指IP层端到端的传输单元（在分片之前和重新组装之后），分组是指在IP层和链路层之间传送的数据单元。
 一个分组可以是一个完整的IP数据报，也可以是IP数据报的一个分片。
 
###  IP路由选择
 * IP层在内存中有一个路由表
   + 当收到一份数据报并进行发送时，它都要对该表搜索一次
   + 当数据报来自某个网络接口时，IP首先检查目的IP地址是否为本机的IP地址之一或者IP广播地址
   + 如果确实是这样，数据报就被送到由IP首部协议字段所指定的协议模块进行处理。
   + 如果数据报的目的不是这些地址
     1. 如果IP层被设置为路由器的功能，那么就对数据报进行转发
     2. 数据报被丢弃
     
### 子网
     
### 给定IP地址和子网掩码以后
 * 可以确定本子网上的主机
 * 可以区分子网
 * 可以区分网络
 * 通过ip地址高位可以得知道ip是A类，B类，C类, 然后确定网络号
 * 通过子网掩码可以知道子网号，也就能确定主机号
 
 