## 数据库迁移

### 不停服，平滑迁移

#### 追日志法
 1. 旧服务升级，记录“对旧库上的数据修改”的日志
   * 只记录delete key, update key, insert key
 2. 通过小工具进行数据迁移
 3. 通过小工具，读取日志记录，追平数据差异
   * 如果未追平，一直读取
 4. 通过小工具，校验数据一致性，是否一样两个库
   * 可能需要a库,临时做一个只读。不可写。防止一真追不平
 5. 流量切换

#### 双写
 1. 旧服务升级，记录“对旧库上的数据修改”进行新库双写
 2. 通过小工具，进行数据迁移
 3. 通过小工具，检验数据一致性
 4. 切流量 