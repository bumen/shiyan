## mysql数据库

### 数据库原理
 * sql 子查询
   + 相关子查询：放在select后，外部select每扫描一行，子查询就执行一次。效率低
   + 非相关子查询：放在select后，子查询执行一次
   

#### MyISAM与Innodb区别
 * 使用count(*)
   + MyISAM会记录表数据量，速度快
   + Innodb会查询会表，速度慢
 * 使用带where条件的count(*)
   + MyISAM与Innodb性能差不多，如果有索引查在索引后扫描所有记录
 * 全文索引
   + MyISAM带全文索引
   + Innodb5.6之前不带，之后带
   + 但数据量大，高并发场景不要使用自带全文索引，会导致小量请求占用大量数据库资源
   + 应该使用索引外置：ES, Lucence
 * 事物
   + MyISAM不支持事物
   + Innodb支持物事。它提供了commit, rollback，崩溃修复能力。但也非常大消耗性能，会影响吞吐量
   + 建议在强一致性要求才使用
 * 外键
   + MyISAM不支持外键
   + Innodb支持外键
   + 不管哪种引擎，在大并发下都应该使用外键。建议由应用程序保证完整性
 * 锁
   + MyISAM只支持表锁
      - select+ insert的业务应用MyISAM，因为在文件尾部顺序增加记录速度很快
      - 但一般是混合读写，只要数据量大和并发量大一律使用Innodb
   + Innodb支持行锁 
 
### 数据库设计

### 数据库调优

### 主从数据库一致性
#### 为什么会出现不一致
 * 主从同步有时延，任何数据冗余，必将引发一致性问题
 
#### 解决
 * 可以允许一段时间的不一致
 * 强制读主，读写都在主库（保证高可用）通过加缓存提升系统读性能
 * 选择性读主
   + 把要写的key记录到redis
   + 读的时候如果redis有记录则去读主，如果redis没有则去读从

### 关系型数据库
 * ACID原则
 * 范式
   
#### 范式 Normal Form
 * 满足最低要求叫第一范式，再进一步满足一些要求为第二范式。
 各范式呈次规范，越高的范式数据库冗余越小。通常用到的只是前三范式
 * 范式可以避免数据冗余，减少数据库空间，减轻维护数据完整性麻烦
 * 按照范式的规范设计出来表，等级越高的范式设计出来的表越多
 
 * 第一范式（1NF）
   + 强调列的原子性。即无重复列 
 * 第二范式（2NF）
   1.表必须有主键
   2.没有包含在主键中的列必须完全依赖于主键，而不能只依赖于主键的一部分。
 * 第三范式（3NF）
   + 任何非主属性不依赖其它非主属性（在2NF基础上消除传递依赖）
   + 即一张表非主属性不依赖于其它表非主属性(一张表非主属性只依赖其它表主属性即可-不是传递关系的依赖)，避免冗余
 * 巴斯-科德范式（BCNF）
 * 第四范式（4NF）
 * 第五范式（5NF）
 
### 反范式
 * 允许适当的数据冗余，用这个冗余去实现取操作数据时间的缩短。
 减少查询时的表关联，是空间换时间。
 