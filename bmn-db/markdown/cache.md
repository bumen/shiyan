## 缓存设计

### 先更新数据库还是先更新缓存
 * 结论：先delete缓存，再插入数据
 * 说明：
   + 先更新数据库再更新缓存，如果1操作成功，2操作失败。两个操作没有原子性
   此时缓存还是旧数据。此时业务不正确
   + 先更新缓存再更新数据库，如果1操作失败，2不会执行，直接返回50x
   如果1操作成功，包括set或delete
   如果set成功，2操作失败，则缓存是最新，但数据库不存在，则业务不正确
   如果del成功，2操作失败，则缓存miss, 数据库不存，直接返回50x，允许

### 缓存与数据库一致性
 
#### 不一致的产生
 * 由于主从同步，读写分离。当写入主时，删除了redis。此时去从库读。但从库未完成主库同步，
 此时返回的旧数据。造成redis缓存了旧的数据
 
#### 解决一致性方案
 * 通过DTS工具订阅从主库binlog，可以准确知道从库是否同步完成，
 此时再向缓存发起删除，淘汰这段时间可能写入缓存的旧数据。
 



