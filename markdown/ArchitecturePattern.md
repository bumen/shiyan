## 大型架构模式

### 分层
 * 应用层，服务层，数据库层
 * 即跨进程的分层架构
   + 进程内也有分层如：MVC
 * 互联网分层构架是一个数据移动，处理，呈现的过程，其中数据移动是整个过程的核心。
 数据处理和呈现要CPU计算，CPU是固定不动的。
 
 * 分层构架演进核心原则与方法：复用，封装
   + 让上游更高效的获取与处理数据，复用
   + 让下游能屏蔽数据的获取细节，封装
 
#### 数据移动
 * 跨进程移动
 * 进程内移动
 * 数据移动两个东西很重要：数据传输格式，数据在各层的形态
 * 数据传输格式
   + service与db/cache之间，二近制协议、文本协议是数据传输的载体
   + web-server与service之间，RPC的二近制协议是数据传输的载体
   + client和web-server之间，http协议
 * 数据在各层次的形态
   + db层, 数据以行为单位
   + cache层，数据以kv的形式
   + service层，数据以Object对象形式
   + web-server层, http有好的json对象
   + client层
   
#### 什么时候进行DAO层抽象
 * 如果没有DAO层抽象，web-server直接操作db，如果业务不复杂还好，如果业务越来越复杂，有大量冗余，重复代码
   + 创建连接
   + 拼装sql
   + 执行sql
   + 获取结果集
   + 关闭连接
 * 通过ORM框架，实现DAO层抽象，简化数据获取过程，提高数据获取效率，向上游屏蔽底层复杂性。
   + 表与类映射
   + 字段与属性映射
   + sql与函数映射
   
#### 什么时候要进行数据服务层抽象
 * 如果多个业务子系统会访问同一份数据，则需要抽象数据服务层
   + 如果没有数据服务层，则每个子系统都需要关注缓存，分库，读写分离的复杂性
   + 如果有抽象层，通过RPC接口调用，只有一处需要关注缓存，分库，读写分离这些复杂性
   
 * 随着业务越来越复杂，业务系统会不断进行垂直拆分。不同业务不同系统
 * 随着数据越来越大，数据库会进行水平切分
 * 随着读并发的越来越大，会增加缓存
 
#### 什么时候要进行通用业务层服务化
 * 当有多个数据服务层是，多个web-server访问多个数据服务层。会出现每个web-server的复杂性
 * 通过抽象通用业务服务层，通过服务层访问多个数据服务层。屏蔽多全web-server访问复杂性
 * 好处：
   + 保有通用业务service处写一次，没有代码拷贝
   + 如果有bug， 只有一处需要升级修改
   + web-server获取数据只需要一个RPC调用
   
#### 为啥要前后端分离
 * 不同pc, app, mobile访问共同数据
   + 即不同平台调用多个通用业务层（可能参数不同，少数service不需要调用，展现交互有区别）
 * 通过站点展示层实现页面展示。node.js, 负责数据展示与交互
 * 通过站点数据层，web-server, 负责业务逻辑与json数据接口的提供

### 分割
 * 网站越大，功能越复杂，服务和数据处理的种类也越多，将这些不同的功能和服务分隔开来。包装成高内聚低耦合的模块单元。
 一方面有助于软件的开发和维护；另一方面，便于不同模块的分布部署，提高网站并发处理能力和功能扩展能力。

### 分布式
 * 大型网站，分层和分割的一个主要目的是为了切分后的模块便于分布式布署，即将不同模块部署在不同的服务器上。
 通过远程调用协同工作。分布式意味着可以使用更多的机器完成同样的功能。机器越多，cpu，内存，存储资源也越多。
 能处理的并发访问量和数据量就越大，进而为更多的用户提供服务。
 * 分类
   + 分布式应用和服务
   + 分布式静态资源
   + 分布式数据和存储
   + 分布式计算

### 集群
 * 使用分布式虽然将分层和分割后的模块独立部署，但是对用户访问集中模块，还需要将独立部署的服务器集群化，
 即多台服务器部署相同应用构成一个集群通过负载均衡设备对外提供服务
 
### 缓存
 * CND
 * 反向代理
 * 本地缓存
 * 分布式缓存

### 异步
 * 单一服务器，通过多线程共享队列的方式实现异步；
 * 分布式系统，多个服务器集群通过分布式消息队列实现异步

### 冗余
 * 数据库除了定期备份，存档保存，实现冷备份之外，为了保证在线业务高可用，还需要对数据库进行主从分离，实时同步实现热备份。

### 自动化
 * 在无人值守的情况下，实现自动化

### 安全

## 大型网站核心要素

### 性能
 * 性能优化

### 可用性
 * 使用集群

### 伸缩性
 * 是否可以用多台服务器构建集群，是否易向集群中添加新的服务器。
 加入新的服务器是否可以提供和原来的无差别服务

### 扩展性
 * 在网站增加新的业务产品时，是否可以实现对现有产品透明无影响。
 不需要改动或者很少改动现有业务功能就可以上线新产品。不同产品之间是否很少耦合。

### 安全性
 * 对现存的或潜在的各种攻击和窃密手段，是否有可靠的应对策略。