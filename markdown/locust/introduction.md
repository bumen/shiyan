## 软件测试
 * 内部压力
 * 基于云计算的压力测试
 * 用户视角的外部压测
 * 性能测试相关术语：
   + 并发用户数：指网络设备所能处理的最大会话数量。这里的会话数是指请求->响应一次会话。
   + 事务响应时间
   + 吞吐量：（Throughput）吞吐量是指在不丢包的情况下单位时间内通过网络设备的数据包数量。
   + TPS：Transactions Per Second（每秒事务处理数），
   指服务器每秒处理的事务次数。一般用于评估数据库、交易系统的基准性能。
   + QPS：Queries Per Second（查询量/秒），
   是服务器每秒能够处理的查询次数，例如域名服务器、Mysql查询性能。
   一定需要指明是多少并发用户数下的QPS
   + RPS：Request Per Second（请求数/秒）
     RPS（Request Per Second）和QPS可以认为是一回事。
   + RT：Response Time（响应时间）：客户端发一个请求开始计时，到客户端接收到从服务器端返回的响应结果结束所经历的时间，
   响应时间由请求发送时间、网络传输时间和服务器处理时间三部分组成。也叫Think Time。
   + 性能计数器等。
   
 * 整个服务对客户的效率最终取决于吞吐量，而不是并发数
   
 * 并发数与TPS/QPS的关系：
   + QPS（TPS）= 并发数/平均响应时间
   + 这里的并发数如果为事务处理请求数，则为TPS，如果为查询请求数，则为QPS。
   + locust中：并发数(也相当于应用层的吞吐量)= rqs * Average
   
 * 网络层面并发数和吞吐量的关系
   + 并发数x包长度=吞吐量
   + 可以看出，在网络层面考察吞吐量，除了并发数，还要考虑请求包的大小（长度）。用于度量网络设备时候，可以用byte/秒
   + locust中： content-size * 并发数
   
 * 单台服务器每天PV计算。服务6小时
   + 每天总PV = QPS * 3600 * 6
 * 服务器计算
   + 服务器数量 = ceil( 每天总PV / 单台服务器每天总PV )
   
 * 每天80%的访问集中在20%的时间里，这20%时间叫做峰值时间
   + ( 总PV数 * 80% ) / ( 每天秒数 * 20% ) = 峰值时间每秒请求数(QPS)
   + 峰值时间每秒QPS / 单台机器的QPS = 需要的机器
   + 每天300w PV 的在单台机器上，这台机器需要多少QPS？
     - ( 3000000 * 0.8 ) / (86400 * 0.2 ) = 139 (QPS)
   + 如果一台机器的QPS是58，需要几台机器来支持？
     - 139 / 58 = 3
 
 * 性能测试方法：
   + 负载测试（Load Testing）
   + 压力测试（Stress Testing）
   + 配置测试
   + 并发测试
   + 可靠性测试等。疲劳强度测试
 * 性能测试工具架构一般包括：
   + 虚拟用户脚本产生器（Virtual User Generator）
   + 压力产生器（player）
   + 用户代理（Agent）
   + 压力调度和监控系统（Controller）
   + 压力结果分析工具（Analysis）。
   

### 负载测试
 * 定义：通过（如逐渐增加用户数量）来观察不同负载下系统的响应时间和数据吞吐量，系统占用的资源，从而发现系统存在的瓶颈，内存泄露，不能实时同步。
 * 负载测试是为是发现系统的性能问题，通过发现系统特性或行为来发现问题。
 * 负载测试目的：是发现软件缺陷
 * 负载测试可以看作性能测试的一部分
 
### 压力测试
 * 定义：在强负载（大数据量，大并发）下测试，分为高负载下的长时间（如24小时以上）的稳定压力测试或极限负载情况下导致系统崩溃的破坏性测试
 * 压力测试可以看作是负载测试的一种，即高负载下的测试。
   + 压力测试可以更快发现内存泄漏，发现性能问题
   + 
   
### 性能测试
 * 目的：是为了获取性能指标
   + 在同样负载的情况下改变系统的结构，改变算法，改变硬件来得到性能指标数据  
 * 性能测试使用负载测试的技术，使用负载测试工具。获得不同负载情况下的性能指标数据
 * 主要手段是通过产生模拟真实业务的压力对被测系统进行加压，与此同时监控被测系统的各项性能指标，研究被测系统在不同压力情况下的表现，找出其潜在的性能瓶颈

### 系统资源性能指标
 * 服务器：CPU利用率、处理器队列长度、内存利用率、内存交换页面数、磁盘IO状态、网卡带宽使用情况等；
 * 数据库：数据库连接数、数据库读写响应时长、数据库读写吞吐量等；
 * 网络：网络吞吐量、网络带宽、网络缓冲池大小；
 * 缓存（Redis）：静态资源缓存命中率、动态数据缓存命中率、缓存吞吐量等；
 * 测试设备（压力发生器）：CPU利用率、处理器队列长度、内存利用率、内存交换页面数、磁盘IO状态、网卡带宽使用情况等。
 * 结论要点2：性能瓶颈定位的重点在于性能指标的监控和分析。
 ``` 
  需要说明的是，性能指标之间通常都是有密切关联的，单纯地看某个指标往往很难定位出性能瓶颈
  举个简单的例子，压力测试时发现服务器端CPU利用率非常高，那这个能说明什么问题呢？
  是服务端应用程序的算法问题，还是服务器硬件资源配置跟不上呢？光看这一个指标并不能定位出产生问题的真正原因，
  而如果仅因为这一点，就决定直接去优化程序算法或者升级服务器配置，最后也很难真正地解决问题。
 ```
 
### 性能测试工具的基本组成
 * 压力生成器（Virtual User Generator）:压力发生器对应的是众多测试人员
 * 结果采集器（Result Collector）: 结果采集器对应的是结果记录人员。采集每个测试人员操作结果
 * 负载控制器（Controller）: 负载控制器对应的是指挥人员。控制并发执行
 * 系统资源监控器（Monitor）: 资源监控器对应的是若干资源监控人员
 * 结果分析器（Analysis）: 结果分析器对应的是结果统计人员
 
### locust 
 * LocustRunner
   + 压力生成器
   + 跟据孵化率孵化产卵locust
 * LocustRunner
   + 负载控制器
   + rate参数
   
 * RequestState
   + 结果采集器
   
 * state
   + 结果分析器
   
 * 系统资源监控器
   + 不支持