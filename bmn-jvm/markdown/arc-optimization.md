## 架构优化

### 实现高并发优化
 * 查看高并发的瓶颈在哪里？
   + 可能是服务器网络带宽不够
   + 可能web连接数不够
   + 可能是数据库查询上不去
   
#### 计算网络流量是否够
 * 定位是否流量不够
 * 使用CND加速，
 * 使用腾讯云，阿里云，存放静态文件
 * 可以增加网络带宽
 * DNS域名解析分发多台服务器
 
##### 计算页面每秒请求数
 * 统计日平均PV，APV
 * 一次PV大概200个请求（js/css/img/ajax）
 * APV * 200 = 日平均请求数
 * 通过日平均请求数，一天昼夜比1:10计算，白天(10:00-22:00)12小时，则计算每秒多少个请求
 * 如APV = 6000, 6000 * 200 = 120万，平均白天110万。120万/24/60/60 = 13/s
 
##### 计算带宽数
 * 日平均6000PV
 * 平均200个请求是7MB
 * 总流量是6000 * 7 = 42G
 * 昼夜1：10， 白天38.2G
 * 每秒流量=38.2/12/60/60 = 0.905Mb/s
 * 换算为带宽为7.24Mbps

 
#### web连接数不够，web服务器压力是否正常
 * 压力测试，查看cpu, 内存，io
 * cpu是否100
 * 内存是否溢出
 * io是否出现TIME_WAIT, LAST_ACK太多
 * io是否有服务器消费消息过慢。导致socket接收缓冲区满，造成网络阻塞
 * 解决
   + 频繁使用的对象，使用对象池
   + 使用单例
   + 异步执行，加消息队列
   + 无锁或乐观锁
   
#### 数据库查询上不去
 * sql查询优化
   + 慢查询
 * 读写分离
 * 分库
 * 加缓存