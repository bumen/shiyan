## jvm性能优化

### 工作线程数究竟要设置多少
 * 纯异步
   + 设置很少线程数就能够做到很高吞吐量
   + 一般设置cpu核数一样
   
 * 工作者线程模型
   + 通过日志打印，统计cpu计算时间与等待时间不需要占cpu时间。通过两个时间比
   + 如：占用cpu时间100ms, 非cpu时间（磁盘io, db, 网络io）100ms, 它们比是1：1
   即有50%时间在计算（占用cpu），有50%时间在等待（不占用cpu）
   + 单核时，需要2个工作线程满足cpu100%
   + N核时，设置为2N个工作线程满足N*100%
 * 结论
   + N核服务器，通过执行业务的单线程分析出本地计算时间为x, 等待时间为y, 则工作线程数设置为N*(x+y)/x，能让cpu利用率最大化。
   
   
### java 程序重启之后必然会导致 load 高的一个jvm特性
 * HotSpot VM 是采用 解释执行 + JIT(just-in-time 即时) 编译器编译热点(这就是 HotSpot VM 名字的由来)代码的方式运行。
 * 在Client Compiler（简称C1,轻量级编译器，fast，效果大概和gcc -o1类似）下运行，运行次数达到1000就会触发编译。
 * 在Server Compiler（简称C2，重量级编译器，smart，效果大概和gcc -o2类似）下运行，运行次数达到10000时触发编译。