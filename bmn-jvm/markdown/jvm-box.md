## java 沙盒模型
 * “沙盒”安全模型是内建于java结构中
 
### 安全模型
 * 为了防止用户系统受到通过网络下载的不安全程序的破坏，java提供了一个可自定义的可以在里面运行java程序的“沙盒”
 * java的安全模型使得java成为适合于网络环境的技术。
 * 使用
   + 网络下载代码可以在沙盒里做任何事情，但不能读或修改沙盒外的任何数据，沙盒可以禁止不安全程序的很多活动
   + 对硬盘进行读写
   + 和别的主机进行网络连接
   + 创建1一个新的过程
   + 载入一个动态库并直接调用本地方法
  * 思相
   + 沙盒模型的思想是在信任的环境中运行不信任的代码，这样即使用用户不小心引入不安全的代码，也不会对系统造成破坏。
 
### 沙盒模型
 * 构成
   + 内建于java虚拟机和语言的安全特性
   + 类的载入结构
   + 类文件校验
   + 安全管理器和java API
   
#### 内建于jvm和语言的安全特性
 * 安全的类型转换：
   + 运行时系统对对象处理要进行类型相容性检查，以防止不安全的转换。
   + 没有指针
   + 自动垃圾回收
      - c通过mallc(), free()分配与回收内存
      - c++通过new, delete来分配与回收内存
      - 再次回收已经释放的内存块或未被分配的内在块，会造成系统崩溃。同样，忘记释放已分配内存，造成资源耗尽。
   + 数组界限检查
      - 若程序中有数组访问，JVM就会查检数组访问是否越界，从而防止由数据越界引起的错误。
   + 查检null引用。
   
 * 类载入器结构
   + 不同类加载器，代表不同的类命名空间。通过类加载器可以区分这个类是否安全
   + 类加载器是防止不安全代码的第一道围墙
      - 防止不安全代码访问，破坏安全代码。
      - 防止不安全代码冒充安全类
   + 实现
      - 将代码放到不同命名空间，并在不同空间的代码之间设置屏障。
      - jvm中，同一命名空间中的类可以直接相互作用，不同命名空间中的类甚至不能检测到对方存在，除非程序允许它们互相作用。
      - 保护可信任类库的边界
 
 * 类文件校验器
   + 校验分2个阶段
   + 阶段1，只校验字节码完整性与文件格式和内部一致性
   + 阶段2，字节码校验，如符号引用校验
   
 * 安全管理器和java API
   + 安全管理器定义了“沙盒”的外部边界。
   + 安全管理器是类java.lang.SecurityManager的子类，它是自定义的。
   + java API类在采取一些行动时，通常需要安全管理器查检这个行动是否安全
      - 接受来自于特定主机的socket连接
      - 修改线程
      - 开放特定于主机的socket连接
      - 创建一个新的类加入器
      - 删除特定文件
      - 创建新的过程
      - 程序退出
      - 调用含有本地文法的动态库
      - 等待连接
      - 从特定的包载入类
      - 给特定包添加一个新类
      - 访问或修改系统特性
      - 读，写文件
   + java执行一个可能不安全活动的过程，通常分2步，首先代码检查安全管理器是否已经安装。如果没有安装，就无法进行第2步的检查。
   则直接执行不安全代码。如果安装了，调用安全管理器中合适的检查方法对动作进行检查，如果动作禁止，检查方法就抛出异常
      